<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Annotations</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <style>
      #tooltip {
          display: none;  /* Initially hidden */
          position: absolute;
          background-color:  #ccc;
          padding: 10px;
          width: 200px;
          position: fixed;
          z-index: 1000;
          box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      .underline {
       text-decoration: underline;
   }
    </style>

    <h1>Annotation engine</h1>

    <form id="shloka-form">
        Chapter: <input type="number" name="chapter" value="{{ chapter }}" required>
        Shloka ID: <input type="number" name="shloka_id" value="{{ shloka_id }}" required>
        <button type="submit">Get Shloka</button>
    </form>

    <h2>Selected Verse</h2>
    <div id="verse">{{ verse | safe }}</div>  <!-- Display the selected verse -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<h3>Tokens</h3>
<!-- Tooltip HTML Structure -->
<div id="tooltip" style="display:none"></div>

<div id="tokens">
    {% for line_tokens in tokenized_list %}
        <div>
            {% for token in line_tokens %}
                <span class="tooltip"
                      data-lakara="{{ token.lakara }}"
                      data-vacana="{{ token.vacana }}"
                      data-linga="{{ token.linga }}"
                      data-vibhakti="{{ token.vibhakti }}"
                      data-prayoga="{{ token.prayoga }}"
                    {{ token.text }}
                </span>
            {% endfor %}
        </div>
    {% endfor %}
</div>

<!-- <h2>Annotate</h2> -->
<!-- <form id="annotation-form"> -->
<!--   <input type="hidden" name="chapter" id="annotation-chapter" value="{{ chapter }}"> -->
<!--   <input type="hidden" name="shloka_id" id="annotation-shloka-id" value="{{ shloka_id }}"> -->
<!--   <textarea name="text" required></textarea> -->
<!--   <button type="submit">Save Annotation</button> -->
<!-- </form> -->

<div id="token-info" style="display: none;">
    <h2>Token Information</h2>
    <div id="token-content"></div>
</div>

<script>
  $('#shloka-form').submit(function(event) {
      event.preventDefault();
      $.post('/get_shloka', $(this).serialize(), function(data) {
          $('#verse').text(data.verse);
          $('#tokens').empty();
          let line = '<br>';
          data.tokenized_list.forEach(line_tokens => {
              line_tokens.forEach(token => {
                  line += `<span class='tooltip' data-lakara='${token.lakara}' data-prayoga='${token.prayoga}' data-vacana='${token.vacana}' data-linga='${token.linga}' data-vibhakti='${token.vibhakti}'>${token.text}</span> `; // Append each token's text to the line                      
              });
              line += "<br>";
          });
          $('#tokens').append(`<div>${line}</div>`); // Append the entire line as a new div
      })});

   $(document).ready(function() {
     $(document).on('mouseenter', '.tooltip', function(e) {
        console.log("Tooltip hover event triggered."); // Debug message
         // Show the tooltip with the corresponding data attributes
         var lakara = $(this).data('lakara');
         var vacana = $(this).data('vacana');
         var linga = $(this).data('linga');
         var vibhakti = $(this).data('vibhakti');
         console.log(lakara);
         var content = 
             "<strong>Lakara:</strong> " + lakara + "<br>" + 
             "<strong>Vibhakti:</strong> " + vibhakti + "<br>" + 
             "<strong>Linga:</strong> " + linga + "<br>" + 
             "<strong>Vacana:</strong> " + vacana;
         $('#tooltip').html(content)
                      .css({
                          top: e.pageY + 20,  // Adjust position below the cursor
                          left: e.pageX + 10
                      })
                      .fadeIn(200);  // Show the tooltip
         $(this).css('text-decoration','underline');
     });
     $(document).on('mouseleave', '.tooltip', function() {
         $('#tooltip').fadeOut(200);  // Hide the tooltip when not hovering
         $(this).css('text-decoration','none');

     });
 });
</script>


</body>
</html>
